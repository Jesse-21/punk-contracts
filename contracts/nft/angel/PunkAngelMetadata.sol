// SPDX-License-Identifier: GPL-3.0-or-later
pragma solidity ^0.8.4;

import "base64-sol/base64.sol";
import "@openzeppelin/contracts/access/Ownable.sol";
import "@openzeppelin/contracts/utils/Strings.sol";

/// @title Punk Angel NFT Metadata contract
/// @author Tempe Techie
/// @notice Contract that generates metadata for the Punk Angel NFT.
contract PunkAngelMetadata {
  enum Cat{ ARMS, BG, DRESS, FACE, HAIR, SKIN }

  string[] bg1 = ["3A1174", "007E6F", "3d43b4", "cb5eee", "f06966", "402662", "f40076", "737dfe", "402565", "000066"];
  string[] bg2 = ["741911", "004300", "041348", "4be1ec", "fad6a6", "3900a6", "342711", "ffcac9", "30be96", "6699ff"];
  string[] hair = ["F257FF", "d55c64", "000000", "6daf76", "389695", "fbe5bb", "b32010", "f7efc8", "733a00", "7700a6"];
  string[] skin = ["CA965A", "E6A066", "F8B88F", "557bcd", "C63725", "7AAE29", "5E320C", "00BB8F", "F9BB8F"];
  string[] ears = ["CA965A", "E6A066", "F8B88F", "4271b7", "C63725", "7AAE29", "5E320C", "00BB8F", "F9BB8F"];
  string[] dress = ["000000", "F3E600", "ffffff", "FF003C", "000000", "04DAF6", "ffffff"];

  string[] face = [
    "",
    '<g id="layer_7" data-name="layer 7"><rect class="cls-24" x="175.52" y="158.97" width="134.28" height="64.92" rx="32.38"/><path class="cls-25" d="M277.41,166a25.42,25.42,0,0,1,25.39,25.39v.15a25.42,25.42,0,0,1-25.39,25.39H207.9a25.42,25.42,0,0,1-25.38-25.39v-.15A25.42,25.42,0,0,1,207.9,166h69.51m0-7H207.9a32.48,32.48,0,0,0-32.38,32.39v.15A32.48,32.48,0,0,0,207.9,223.9h69.51a32.48,32.48,0,0,0,32.39-32.39v-.15A32.48,32.48,0,0,0,277.41,159Z"/></g>', 
    "", "", 
    '<g id="layer_8" data-name="layer 8"><path class="cls-24" d="M242.39,199a142.43,142.43,0,0,1-48.83-8.5v-8.7c1.46-.52,21.89-7.54,49.79-7.54a154.94,154.94,0,0,1,48.41,7.54v8.71C290.36,191.06,270.31,199,242.39,199Z" /><path class="cls-25" d="M243.35,174.37a154.79,154.79,0,0,1,48.29,7.5v8.53c-1.93.78-21.78,8.45-49.25,8.45a142.43,142.43,0,0,1-48.71-8.45v-8.53c2-.71,22.23-7.5,49.67-7.5h0m0-.25c-29.17,0-49.92,7.57-49.92,7.57v8.88a142.71,142.71,0,0,0,49,8.53c29.17,0,49.5-8.53,49.5-8.53v-8.88a155.22,155.22,0,0,0-48.54-7.57Z" /><line class="cls-26" x1="201.69" y1="186.61" x2="259.5" y2="186.61" /><line class="cls-27" x1="267.84" y1="186.61" x2="282.57" y2="186.61" /></g>',
    "",
    '<g id="layer_9" data-name="layer 9"><path class="cls-19" d="M195.67,192.08s8.14-.71,20,5.48c0,0,7.61,4.07,12-1.59,0,0,8.67-10.44,15-11.68,0,0,6.9.89,13.09,11a12.77,12.77,0,0,0,13.8,2.66s14-7.26,20.35-6.28l7.78,3.45s-5.3,44.94-19.81,59.62l-23.36,7.78-1.59,15h-20.7l-1.94-15.39-21.23-5.66s-14-5.66-21.94-60.86Z"/><path class="cls-24" d="M224.87,223.31l3.53.08,6.72,7.52h14.33l7.26-7.52h4.07V234l-8,22.29h-20l-7.78-23Z"/><path class="cls-25" d="M226.87,220s2.3-13.21,15.6-13c0,0,10.82-.36,14.83,13Z"/><rect class="cls-25" x="233.97" y="265.86" width="17.25" height="10.08" rx="5.04"/><ellipse class="cls-24" cx="265.22" cy="251.65" rx="4.45" ry="4.99"/><ellipse class="cls-24" cx="220.42" cy="251.65" rx="4.45" ry="4.99"/><rect class="cls-26" x="237.84" y="235.13" width="8.96" height="15.81" rx="4.14"/><ellipse class="cls-24" cx="292.59" cy="227.66" rx="24.5" ry="12.92" transform="translate(1.35 457.03) rotate(-76.11)"/><ellipse class="cls-19" cx="295.63" cy="228.41" rx="15.82" ry="8.34" transform="translate(2.93 460.55) rotate(-76.11)"/><ellipse class="cls-24" cx="296.98" cy="228.74" rx="11.45" ry="6.03" transform="translate(3.63 462.12) rotate(-76.11)"/><ellipse class="cls-24" cx="192.15" cy="227.66" rx="12.92" ry="24.5" transform="translate(-49.04 52.79) rotate(-13.89)"/><ellipse class="cls-19" cx="190.16" cy="228.15" rx="8.34" ry="15.82" transform="translate(-49.21 52.33) rotate(-13.89)"/><ellipse class="cls-24" cx="188.82" cy="228.48" rx="6.03" ry="11.45" transform="translate(-49.33 52.02) rotate(-13.89)"/><path class="cls-24" d="M233.47,198.68s8.85-9,17.93,0v3.66s-8.37-7.9-17.93,0Z"/><rect class="cls-24" x="235.42" y="267.74" width="14.21" height="1.24"/><rect class="cls-24" x="235.36" y="273.05" width="14.21" height="1.24"/><rect class="cls-24" x="235.36" y="270.4" width="14.21" height="1.24"/></g>',
    ""
  ];

  string[] arms = [
    "","",
    '<ellipse class="cls-23" cx="158.34" cy="359.35" rx="0.55" ry="0.54" /><polyline class="cls-22" points="145.39 373.85 145.39 395.87 153.06 403.35 153.06 415.29 145.39 422.97 145.39 461.67 148.39 464.91 148.01 478.23 143.21 482.07 143.21 491.67" /><circle class="cls-23" cx="145.39" cy="373.85" r="0.8" /><path class="cls-22" d="M142.25,473.09V458l-7.6-7.87v-30.7l7.6-7.34v-8l-7.6-8V366.29l5.51-.07,6.84-16-.09-10.76" /><circle class="cls-23" cx="147" cy="339.43" r="0.8" /><polyline class="cls-22" points="153.06 487.45 153.06 456.01 158.34 449.74 158.34 431.65 153.06 426.65 153.06 421.37 158.34 416.49 158.34 400.98 153.06 395.79 153.06 385.42 158.34 380.41 158.34 370.6 158.34 359.35" /><ellipse class="cls-23" cx="153.06" cy="487.45" rx="0.55" ry="0.54" /><ellipse class="cls-23" cx="143.21" cy="491.67" rx="0.55" ry="0.54" /><ellipse class="cls-23" cx="142.25" cy="473.09" rx="0.55" ry="0.54" />',
    "",
    '<ellipse class="cls-23" cx="351.25" cy="359.72" rx="0.55" ry="0.54" /><polyline class="cls-22" points="364.2 374.22 364.2 396.24 356.52 403.72 356.52 415.65 364.2 423.34 364.2 462.04 361.2 465.28 361.58 478.6 366.38 482.44 366.38 492.04" /><circle class="cls-23" cx="364.2" cy="374.22" r="0.8" /><path class="cls-22" d="M367.33,473.46V458.35l7.61-7.87v-30.7l-7.61-7.34v-8l7.61-8V366.66l-5.52-.07-6.84-16,.09-10.75" /><circle class="cls-23" cx="362.58" cy="339.81" r="0.8" /><polyline class="cls-22" points="356.52 487.82 356.52 456.38 351.25 450.11 351.25 432.02 356.52 427.02 356.52 421.74 351.25 416.86 351.25 401.35 356.52 396.16 356.52 385.79 351.25 380.78 351.25 370.98 351.25 359.72" /><ellipse class="cls-23" cx="356.53" cy="487.82" rx="0.55" ry="0.54" /><ellipse class="cls-23" cx="366.38" cy="492.04" rx="0.55" ry="0.54" /><ellipse class="cls-23" cx="367.28" cy="473.46" rx="0.55" ry="0.54" />',
    "",
    '<ellipse class="cls-23" cx="158.34" cy="359.35" rx="0.55" ry="0.54" /><polyline class="cls-22" points="145.39 373.85 145.39 395.87 153.06 403.35 153.06 415.29 145.39 422.97 145.39 461.67 148.39 464.91 148.01 478.23 143.21 482.07 143.21 491.67" /><circle class="cls-23" cx="145.39" cy="373.85" r="0.8" /><path class="cls-22" d="M142.25,473.09V458l-7.6-7.87v-30.7l7.6-7.34v-8l-7.6-8V366.29l5.51-.07,6.84-16-.09-10.76" /><circle class="cls-23" cx="147" cy="339.43" r="0.8" /><polyline class="cls-22" points="153.06 487.45 153.06 456.01 158.34 449.74 158.34 431.65 153.06 426.65 153.06 421.37 158.34 416.49 158.34 400.98 153.06 395.79 153.06 385.42 158.34 380.41 158.34 370.6 158.34 359.35" /><ellipse class="cls-23" cx="153.06" cy="487.45" rx="0.55" ry="0.54" /><ellipse class="cls-23" cx="143.21" cy="491.67" rx="0.55" ry="0.54" /><ellipse class="cls-23" cx="142.25" cy="473.09" rx="0.55" ry="0.54" /><ellipse class="cls-23" cx="351.25" cy="359.72" rx="0.55" ry="0.54" /><polyline class="cls-22" points="364.2 374.22 364.2 396.24 356.52 403.72 356.52 415.65 364.2 423.34 364.2 462.04 361.2 465.28 361.58 478.6 366.38 482.44 366.38 492.04" /><circle class="cls-23" cx="364.2" cy="374.22" r="0.8" /><path class="cls-22" d="M367.33,473.46V458.35l7.61-7.87v-30.7l-7.61-7.34v-8l7.61-8V366.66l-5.52-.07-6.84-16,.09-10.75" /><circle class="cls-23" cx="362.58" cy="339.81" r="0.8" /><polyline class="cls-22" points="356.52 487.82 356.52 456.38 351.25 450.11 351.25 432.02 356.52 427.02 356.52 421.74 351.25 416.86 351.25 401.35 356.52 396.16 356.52 385.79 351.25 380.78 351.25 370.98 351.25 359.72" /><ellipse class="cls-23" cx="356.53" cy="487.82" rx="0.55" ry="0.54" /><ellipse class="cls-23" cx="366.38" cy="492.04" rx="0.55" ry="0.54" /><ellipse class="cls-23" cx="367.28" cy="473.46" rx="0.55" ry="0.54" />'
  ];

  function getIndex(uint256 _tokenId, Cat _category) internal view returns(uint256) {
    if (_category == Cat.BG) {
      return uint(keccak256(abi.encodePacked(_tokenId))) % bg1.length;
    } else if (_category == Cat.HAIR) {
      return uint(keccak256(abi.encodePacked(_tokenId,address(this)))) % hair.length;
    } else if (_category == Cat.SKIN) {
      return uint(keccak256(abi.encodePacked(address(this),_tokenId))) % skin.length;
    } else if (_category == Cat.FACE) {
      return uint(keccak256(abi.encodePacked(address(0),_tokenId))) % face.length;
    } else if (_category == Cat.DRESS) {
      return uint(keccak256(abi.encodePacked(_tokenId,address(0)))) % dress.length;
    } else if (_category == Cat.ARMS) {
      return uint(keccak256(abi.encodePacked(uint(31337),_tokenId))) % arms.length;
    }

    return 0;
  }

  function getMetadata(uint256 _tokenId) external view returns(string memory) {
    return string(
      abi.encodePacked("data:application/json;base64,",Base64.encode(bytes(abi.encodePacked(
        '{"name": "Cyberpunk Angel #', Strings.toString(_tokenId), '", ',
        '"description": "A collection of Punk Angel NFTs created by Punk Domains: https://punk.domains", ',
        '"image": "', _getImage(_tokenId), '"}'))))
    );
  }

  function _getImagePart1(uint256 _tokenId) internal view returns (string memory) {
    return string(abi.encodePacked('<svg xmlns="http://www.w3.org/2000/svg" width="500" height="500"><defs><linearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#',bg1[getIndex(_tokenId, Cat.BG)],'"/><stop offset="100%" stop-color="#',bg2[getIndex(_tokenId, Cat.BG)],'"/></linearGradient><linearGradient id="grad_42" x1="240.65" y1="245.21" x2="240.65" y2="234.19" gradientUnits="userSpaceOnUse"><stop offset=".41" stop-color="#460c68"/><stop offset=".6" stop-color="#531a6f"/><stop offset=".89" stop-color="#d55d68"/></linearGradient><linearGradient id="grad_49" x1="175.52" y1="191.43" x2="309.8" y2="191.43" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#dcd836"/><stop offset="1" stop-color="#702a86"/></linearGradient><style>.cls-4{fill:#030713;opacity:.58}.cls-13,.cls-14,.cls-21,.cls-22,.cls-6{fill:none}.cls-13,.cls-22,.cls-23,.cls-6{stroke:#ffe7da}.cls-13,.cls-14,.cls-21,.cls-22,.cls-23,.cls-6{stroke-miterlimit:10}.cls-8{fill:#',hair[getIndex(_tokenId, Cat.HAIR)],'}.cls-9{fill:#',skin[getIndex(_tokenId, Cat.SKIN)],'}.cls-12{fill:#5b107f}.cls-11{fill:#',ears[getIndex(_tokenId, Cat.SKIN)],'}.cls-13,.cls-22,.cls-23{opacity:.21}.cls-13,.cls-21,.cls-22,.cls-23{stroke-linecap:round}.cls-14{stroke:#1d1d1b}.cls-17{fill:#ff797c}.cls-18,.cls-23{fill:#ac546b}.cls-19{fill:#0c182c}.cls-20{fill:#1d1d1b}.cls-21{stroke:#f37ead}.cls-22,.cls-23{stroke-width:.9px}'));
  }

  function _getImage(uint256 _tokenId) internal view returns (string memory) {
    string memory svgBase64Encoded = Base64.encode(bytes(string(abi.encodePacked(
      _getImagePart1(_tokenId),
      '.cls-24{fill:#',dress[getIndex(_tokenId, Cat.DRESS)],'}.cls-25{fill:url(#grad_49);}</style></defs><path fill="url(#grad)" d="M0 0h500v500H0z"/><g id="layer_4" data-name="layer 4"><path class="cls-4" d="M285.74 301.62a59 59 0 0121.46-20c22.32-12 44.85-4.75 49.22-3.25 0 0 49.65 5.75 89.49-37.46 0 0 39.53 11.64 11.95 55.77 0 0 21.45 18.39-22.68 41.07 3.35 2.8 4.59 5.44 4.89 7.71 2.37 18.26-53.17 37.84-57.21 39.24q-48.55-41.53-97.12-83.08zM214.06 301.45a59 59 0 00-21.45-20c-22.32-12-44.85-4.75-49.23-3.25 0 0-49.64 5.75-89.48-37.46 0 0-39.53 11.65-11.95 55.78 0 0-21.46 18.38 22.67 41.06-3.4 2.81-4.64 5.44-4.88 7.71-1.9 17.59 53.25 35.79 60.41 38.1z"/><g opacity=".21"><path class="cls-6" d="M181.87 345.81l-24.61-14.95-18.29-.04-12.06-7.32-8.03-15.95-67.54-41.03M158.29 384.64l-18.89-11.47-13 2.87-19.3-11.73-3.09-12.64-17.69-10.75"/><path class="cls-6" d="M162.85 377.13l-26.75-16.25-12.25 2.84-7.86-4.78-3.49-12.39-22.87-13.89-12.25 2.84-15.55-9.45-3.12-12.17-14.48-8.8"/><path class="cls-6" d="M165.34 373.02l-30.5-18.53-13 2.87-19.12-11.61L99.45 333l-33.78-20.52M167.73 369.09l-7.62-4.64-3.2-12.46-19.3-11.72-12.53 2.91-45.04-27.36"/><path class="cls-6" d="M172.4 361.4l-6.45 1.34-31.81-19.32-4.48-13.85-22.39-13.6-13.93 2.67-39.97-24.28"/><path class="cls-6" d="M179.46 349.78l-7.63-4.63-12.68 3.55-19.3-11.72-2.87-13-19.48-11.83-12.68 3.55-26.27-15.95"/><circle class="cls-6" cx="85.85" cy="340.64" r=".94"/><circle class="cls-6" cx="65.67" cy="312.48" r=".94"/><circle class="cls-6" cx="44.23" cy="305.08" r=".94"/><circle class="cls-6" cx="79.61" cy="315.62" r=".94"/><ellipse class="cls-6" cx="53.37" cy="294.36" rx=".94" ry="1.1" transform="rotate(-58.73 53.35 294.347)"/><circle class="cls-6" cx="78.54" cy="299.75" r=".94"/><path class="cls-6" d="M184.15 342.05l-26.91-16.34-2.73-12.3-7.85-4.77-11.98 3.36-23.08-14.01-3-12.47-15.43-9.37-12.18 3.24-14.59-8.86M188.87 334.28l-10.78-6.55-.98-11.06-21.91-13.3-9.88 4.45-5.72-3.47-1.07-11.11-21.25-12.9"/><path class="cls-6" d="M189.36 333.47l-1.26-4.89-36.99-22.47-12.02 3.25-11.41-6.93-2.46-12.05-21.05-12.78M195.79 322.88l-13.54-8.23-.74-11.45-13.81-8.39-10.41 4.69-12.64-7.68"/><ellipse class="cls-6" cx="104.17" cy="277.6" rx=".94" ry=".9" transform="rotate(-58.73 104.152 277.584)"/><ellipse class="cls-6" cx="144.65" cy="291.82" rx=".94" ry=".67" transform="rotate(-58.73 144.632 291.808)"/><ellipse class="cls-6" cx="117.41" cy="280.41" rx=".94" ry=".67" transform="rotate(-58.73 117.39 280.4)"/><ellipse class="cls-6" cx="66.4" cy="270.53" rx=".94" ry=".93" transform="rotate(-58.73 66.386 270.514)"/><circle class="cls-6" cx="51.34" cy="266.52" r=".94"/><path class="cls-6" d="M321.1 349.25l24.61-14.95 18.29-.04 12.06-7.32 8.02-15.95 67.55-41.02M344.68 388.08l18.89-11.47 12.99 2.87 19.31-11.73 3.08-12.64 17.7-10.74"/><path class="cls-6" d="M340.12 380.57l26.75-16.25 12.25 2.84 7.86-4.77 3.48-12.39 22.88-13.9 12.24 2.84 15.55-9.45 3.13-12.17 14.48-8.79"/><path class="cls-6" d="M337.62 376.46l30.51-18.52 13 2.87 19.12-11.62 3.27-12.75 33.78-20.52M335.24 372.53l7.62-4.63 3.2-12.46 19.3-11.73 12.53 2.91 45.04-27.36"/><path class="cls-6" d="M330.57 364.84l6.45 1.35 31.81-19.32 4.47-13.86 22.39-13.59 13.94 2.66 39.97-24.27"/><path class="cls-6" d="M323.51 353.23l7.63-4.63 12.68 3.55 19.3-11.73 2.87-12.99 19.48-11.84 12.68 3.56 26.27-15.96"/><circle class="cls-6" cx="417.12" cy="344.08" r=".94"/><circle class="cls-6" cx="437.3" cy="315.92" r=".94"/><circle class="cls-6" cx="458.74" cy="308.53" r=".94"/><circle class="cls-6" cx="423.36" cy="319.06" r=".94"/><ellipse class="cls-6" cx="449.6" cy="297.8" rx="1.1" ry=".94" transform="rotate(-31.27 449.66 297.823)"/><circle class="cls-6" cx="424.42" cy="303.19" r=".94"/><path class="cls-6" d="M318.82 345.5l26.91-16.35 2.73-12.3 7.85-4.77 11.98 3.37 23.08-14.02 3-12.46 15.43-9.38 12.18 3.25 14.59-8.87"/><path class="cls-6" d="M314.09 337.72l10.79-6.55.98-11.05 21.91-13.31 9.88 4.46 5.72-3.47 1.07-11.12 21.24-12.9"/><path class="cls-6" d="M313.61 336.92l1.25-4.9 37-22.46 12.02 3.25 11.41-6.93 2.46-12.05 21.05-12.78M307.17 326.33l13.55-8.23.74-11.46 13.81-8.39 10.41 4.69 12.64-7.68"/><ellipse class="cls-6" cx="398.8" cy="281.04" rx=".9" ry=".94" transform="rotate(-31.27 398.866 281.065)"/><ellipse class="cls-6" cx="358.32" cy="295.26" rx=".67" ry=".94" transform="rotate(-31.27 358.38 295.28)"/><ellipse class="cls-6" cx="385.56" cy="283.86" rx=".67" ry=".94" transform="rotate(-31.27 385.612 283.887)"/><ellipse class="cls-6" cx="436.57" cy="273.97" rx=".93" ry=".94" transform="rotate(-31.27 436.64 273.99)"/><circle class="cls-6" cx="451.63" cy="269.97" r=".94"/></g><ellipse cx="271.16" cy="75.45" rx="14.16" ry="30.31" transform="rotate(-75 270.282 75.025)" stroke-miterlimit="10" opacity=".21" stroke-width="1.5" stroke="#ffe7da" fill="none"/></g><path class="cls-8" d="M249.12 99.48s-4-9.09-15.66-7.2c0 0 7.38 1.26 11 6.21 0 0-11.79-6.84-17.91-3.6 0 0 4.32-.36 6.3 2.16 0 0-12-1.08-14.13 1 0 0 2.52.72 2.61 1.44 0 0-8.19-.18-10.35 3.69h3s-6.36 3.12-8.7 7.62a11 11 0 00-8.88 3.6s-11.1 2.88-28.08-.9a20.67 20.67 0 0011.22 5 10 10 0 01-5.28.54s8.94 5 15.9 4.8a26.83 26.83 0 01-6.9 2.76 13.44 13.44 0 006.12.6s-18.54 14.76-19.5 24.33c0 0 2.58-3.15 4.92-3.63 0 0-10.32 12.36-9.36 21.36 0 0 6.54-13.08 11.46-14.16 0 0-9.54 23.34-1.26 46a12.22 12.22 0 011.53-5.94s1.17 18.09 5.85 22.59a31.38 31.38 0 001.53-9.36s3.21 16.41-10.11 37.41c0 0 11.16-11.28 12.48-16.08 0 0-4.8 18.6-8.52 23 0 0 13.44-13.92 15.12-19.8 0 0 0 7.44-1.68 11.64 0 0 6.12-4.08 6-5.76 0 0 .72 5.52-5.28 11.76 0 0-11 8-8.52 24.72 0 0 3.6-10.92 7.08-13 0 0-5.4 14.52 1.32 25.8 0 0-1-16.32 4.56-23.88 0 0 .24 15.72 7.32 21.36 0 0 3.6-12.6 5.4-13.56 0 0 .48 13.32 2.4 16.92 0 0 7.92-15.24 15.36-16.8l46.08-16.38s9.18 2.16 15.66 38.7c0 0 7.2-6.48 7-26.82 0 0 2.35 14.22 0 19.08 0 0 5.4-4 3.24-20.52 0 0 4.14 8.28 7.56 10.08 0 0-4.14-9.54-2.52-15.66 0 0 5.4 10.08 10.26 11.16 0 0-16.74-25.2-13.38-47.76 0 0 20.16 26.88 25.68 27.12 0 0-13.92-14.16-15.12-24.72 0 0 11.76 16.08 19.68 16.8 0 0-20.64-13.68-18-25 0 0 .24-16.25-1-25l2.19 2.33s-.27-14.31-3.87-19.71a26.9 26.9 0 016.73 10.3 42.11 42.11 0 00-1.36-7.84 43.2 43.2 0 00-8.6-16.28s7 1.08 13.5 12.78c0 0-2.34-14.94-18.54-29.88 0 0 4-.18 7.74 4.32 0 0-.36-7-8.1-13.86 0 0 8.64 3.78 11.16 8.64 0 0-2.52-13.5-27.54-29.34 0 0 12.24 2.7 19.8 12.06 0 0-6.12-16.74-35.82-20.88 0 0 12.78-7.74 26.82-5.76 0 0-11-6.84-33.3 4.5 0 0-4.32-3.51-7.92-3.6 0 0 5.64-1.71 8.37.18 0 .03-4.68-6.54-14.76-1.68z" id="layer_2" data-name="layer 2"/><g id="layer_3" data-name="layer 3"><path class="cls-9" d="M219.51 251.85s7.74 22.68 2.7 42.66c0 0 25.56 10.62 55.8-1.26 0 0-7.2-27.18-3.24-49.68z"/><path d="M219.73 253.45s25.58 9.32 54.7-7.73q-.37 3.32-.57 6.89a121.92 121.92 0 00.27 17.28 60.85 60.85 0 01-20.21 1.33c-5.79-.6-17.18-1.93-27.24-10.34a41.72 41.72 0 01-6.95-7.43z" opacity=".63" fill="#5b107f"/><path class="cls-11" d="M194.22 188.58a4.21 4.21 0 00-4.5 4s-.63 10.53 5.85 30.42c0 0 1.17 3.51 6.12 2.75zM291.25 187.54a4.2 4.2 0 014.69 3.82s1.14 10.49-4.36 30.67c0 0-1 3.56-6 3z"/><path class="cls-9" d="M195.13 153.13L194 162q-.28 5.33-.42 10.9c-.13 5.48-.13 10.79 0 15.92 0 0 2.79 36.18 13.77 51.3 0 0 16.47 22.86 32.49 22.14a53.06 53.06 0 008.11-1 44.21 44.21 0 0013.06-4.63 46 46 0 007.77-5.69 96.59 96.59 0 0010.93-10.79 43.9 43.9 0 002.82-4.33 47.18 47.18 0 004.62-11.27s5.16-25.8 4.8-46.32c0 0-.72-16.2-2-20.16l-6.3-32.4-87.12 6.84a37.27 37.27 0 00-1.34 20.62z"/><path class="cls-12" d="M252.44 170.43v6.36s23-2.88 29.4-9.36c0 0-23.84 3.36-29.4 3z"/><path class="cls-13" d="M252.8 158.28l1.09 17.43h3.6v5.32h8.71v.75"/><path class="cls-8" d="M193.14 138.36a19 19 0 002.22 18.57l7 .24 2.79-11.74-1.66 12h2.38l1.94-11.43-.63 11.74h1.35l3.37-11.11-1.75 11.37h1.75l2.93-12.78-1.26 12.55 2.16-.09s4-22.32 7.14-26c0 0-6.12 25.23-4 26.36l3.48.22s.72-15.12 4-17.82l-2.07 17.82h2.43s.09-13.68 5.22-22.95l-2.88 23.58h4.68s1.53-15 3.24-18.9c0 0 3.24 12.6.81 18.9h6.12s.9-18.09 3.87-23.13l.69 22.59 7-.09s1.73-16.39 3.54-20.26l1.56 20.85h3.12s.48-8.49 1.8-10.89l2.52 10.92v-15.21l4.32 14.4 8.64-.84-1.56-8.52 4 10.17 3-.69-1.44-8 3.24 7.32h2.4l-.6-34.2-95.28 4.92z"/><path class="cls-12" d="M228.52 170.43v6.36s-23-2.88-29.4-9.36c0 0 23.88 3.36 29.4 3z"/><path class="cls-14" d="M229.68 211.49a16.08 16.08 0 01-1.26 2.61c-.5.63-1.08 5 1.71 6.07a1.91 1.91 0 00.78-.14 3.35 3.35 0 001-.79 3.35 3.35 0 011.39-.89 2.1 2.1 0 011.73.63l2.25 2.77a5.88 5.88 0 00.93.67 3.76 3.76 0 001.17.47 3.43 3.43 0 001.68 0 3.47 3.47 0 001.7-1.05s3.36-3.36 4.68-3.21a1 1 0 01.9.53s1.14 1.45 2.11 1.35a3.3 3.3 0 002.13-2.31 12.58 12.58 0 00.14-3.38 12.79 12.79 0 00-.69-3.12"/><path d="M225.19 235.74s4 9.93 14.72 9.45c0 0 11.35.91 16.2-9.18 0-.01-20.93-3.91-30.92-.27z" fill="url(#grad_42)" opacity=".63"/><path d="M240.4 231.39a7.34 7.34 0 00-9.67 0s-4.56 3.24-7.38 3.3a8.39 8.39 0 008 1.14 15.05 15.05 0 012.58-.48 15.4 15.4 0 012.74 0c2.34.16 2.75.47 4.27.59 2.26.19 2.63-.39 5.13-.47a17.51 17.51 0 015 .59s1.22.31 7.47-.23a28.09 28.09 0 01-7.83-3.6 7.87 7.87 0 00-10.31-.84z" fill="#460c68"/><path class="cls-17" d="M242.34 238.8c0 .33.06.66.08 1a1.87 1.87 0 01-.08 1 2 2 0 01-.09-1l.09-1zM233.25 237.45c-.09.39-.18.77-.28 1.16a2.59 2.59 0 01-.44 1.09 2.72 2.72 0 01.28-1.16c.14-.36.29-.73.44-1.09zM236.62 238.17q.06.45.09.9a1.56 1.56 0 01-.09.9 1.56 1.56 0 01-.09-.9q0-.45.09-.9zM247.15 238.17c.14.28.27.57.4.87a1.72 1.72 0 01.23.93 1.7 1.7 0 01-.4-.87c-.08-.3-.16-.61-.23-.93zM250.3 237.45c.13.21.26.42.37.64a1 1 0 01.22.71 1.11 1.11 0 01-.37-.64c-.08-.24-.15-.47-.21-.71z"/><path class="cls-18" d="M241.11 233.99l-.12-1.98h.25l-.13 1.98zM232.02 235.34l-.84-2.22.24-.07.6 2.29zM235.4 234.62l-.13-1.8h.25l-.12 1.8zM245.93 234.62l.51-1.85.23.09-.74 1.76zM249.07 235.34l.47-1.4.23.09-.7 1.31z"/><path class="cls-19" d="M215.32 182.1s-4.06 6.24 2.38 9.15l3.56.18a7.17 7.17 0 003.58-5.83s-4.03-4.09-9.52-3.5z"/><path class="cls-14" d="M206 186s5 7.46 22 4.88c0 0 .43-.29.09-1 0 0-6.42-14.58-24.06-4"/><path class="cls-20" d="M227.94 187.43a17.42 17.42 0 00-10.57-6 19.42 19.42 0 00-6.22.33c-1 .2-2 .56-3 .83l-2.93 1.18v-.06l2.89-1.33c1-.32 2-.73 3-1a19.7 19.7 0 016.36-.57 14.3 14.3 0 016.12 2 12.65 12.65 0 014.45 4.57z"/><path class="cls-13" d="M268.82 191.55l.82 3.87 9.21-1.09 2.55 6.07 9.73-4.58"/><path class="cls-19" d="M272.14 183.83s2 7.18-5 8l-3.11-.08a9.19 9.19 0 01-1.6-2.73 9.06 9.06 0 01-.4-4.72s5.05-2.67 10.11-.47z"/><path class="cls-14" d="M278.35 187.28s-5.45 7.13-22.26 3.48c0 0-.41-.32 0-1 0 0 7.33-14.14 24.26-2.42"/><path class="cls-20" d="M256.31 187.27a12.61 12.61 0 014.74-4.28 14.25 14.25 0 016.23-1.59 19.8 19.8 0 016.31 1c1 .32 2 .79 3 1.18l2.8 1.5v.07l-2.85-1.37c-1-.33-2-.75-3-1a19.25 19.25 0 00-6.17-.72 16.81 16.81 0 00-5.92 1.65 16.58 16.58 0 00-5 3.66z"/><circle class="cls-8" cx="267.14" cy="186.85" r="1.59"/><path class="cls-9" d="M225.19 293.19a58.23 58.23 0 00-17.68 10.32c-1.95 1-5 2.52-8.88 4.23-25.8 11.47-35.06 8.49-53.16 18.33-7.88 4.28-16.35 9-21.9 18.89-3.63 6.46-4.64 12.66-5.25 22a238.31 238.31 0 002.07 49.62s8.4 50.64 6.24 62.16c0 0-.72 11.44 2.4 21.08h250.32s-.09-17.12-.14-37c0-14.19-1.37-31.18.07-47.25.48-5.4 1.15-11.55 1.15-11.55 1.14-10.36 2.23-17.78 2.43-19.27 1-7.62 1-20.33-3.51-42.71 0 0-4.14-16.2-23.94-20 0 0-34.74-6.3-52.56-14.58 0 0-26.82-14-26.82-16.38z"/><path d="M153.81 322.13s17.7 30.12 14.34 73.31-10.32 60.15 5.76 104.35h165.6s20.64-42-5.76-110.12c0 0-7.93-35.57 7.31-70.59 0 0-30.95-4.17-63.05-25.83 0 0-25.93 11.93-55.8 1.26l-5.82 2.79c-11.1 5.3-21.17 10-23.88 11.25-6.51 2.98-18.36 7.81-38.7 13.58z" class="cls-24"/><path class="cls-21" d="M229.59 325.35s19.92-12 43-1.44M222.87 335.43s27.12-13.2 58.32 0M222.87 348.39s30.72-13 57.12-1M215.67 362.07s38.21-14.18 77.28 0"/><path class="cls-9" d="M178.11 397.29l3.6 6.66S208 393.51 237 404l2.16-6.66s-28.29-14.09-61.05-.05zM264.37 397.29L268 404s26.28-10.44 55.26 0l2.16-6.66s-28.29-14.09-61.05-.05z"/></g><g id="layer_5" data-name="layer 5"><path class="cls-22" d="M271.93 247.65l1.21-1.31v-15.67l-3.1-3.11v-4.83l3.1-3.02v-8.92"/><circle class="cls-23" cx="273.15" cy="210.79" r=".32"/><path class="cls-22" d="M260.61 297.82l1.22-1.3v-15.67l-3.11-3.11v-4.83l3.11-3.03v-8.91"/><circle class="cls-23" cx="261.83" cy="260.97" r=".32"/><path class="cls-22" d="M280.95 237.73v-7.68l3.24-3.19v-7.83l-3.24-3.14v-7.17"/><circle class="cls-23" cx="280.95" cy="208.72" r=".32"/><path class="cls-22" d="M269.38 296.07v-7.68l3.25-3.19v-7.83l-3.25-3.14v-7.17"/><circle class="cls-23" cx="269.39" cy="267.06" r=".32"/><path class="cls-22" d="M274.93 244.73v-6.12l3.08-3.19V223l-3.08-2.97v-3.25l3.08-3.24V201.5"/><circle class="cls-23" cx="278.01" cy="201.57" r=".32"/><path class="cls-22" d="M265.99 252.87v-7.32l2.13-2.03v-2.13l-2.13-1.98v-6.28l2.13-2.1v-4.19l-2.13-2.03v-3.97"/><circle class="cls-23" cx="265.99" cy="220.84" r=".22"/><path class="cls-22" d="M251.38 298.81v-4.73l1.36-1.31v-1.39l-1.36-1.27v-4.06l1.36-1.36v-2.72l-1.36-1.31v-2.57"/><circle class="cls-23" cx="251.38" cy="278.09" r=".14"/>',
      arms[getIndex(_tokenId, Cat.ARMS)],
      '</g>',
      face[getIndex(_tokenId, Cat.FACE)],
      '</svg>'
    ))));

    return string(abi.encodePacked("data:image/svg+xml;base64,", svgBase64Encoded));
  }

}